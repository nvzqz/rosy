language: rust
rust: 1.34.0

matrix:
  allow_failures:
  - os: windows
  include:
  - os: linux
  - os: linux
    env:
    - FEATURES: "--features=static"
  - os: osx
  - os: osx
    env:
    - FEATURES: "--features=static"
  - os: osx
    osx_image: xcode8.0 # macOS 10.11 "El Capitan"
  - os: osx
    osx_image: xcode8.0 # macOS 10.11 "El Capitan"
    env:
    - FEATURES: "--features=static"
  - os: windows
  - os: windows
    env:
    - FEATURES: "--features=static"

env:
  global:
  - RUSTFLAGS: "-Dwarnings"
  - RUST_BACKTRACE: "full"

cache:
  directories:
  - $HOME/.cargo

before_script:
- cargo -Vv
- rustc -Vv
- ruby -e "require 'pp'; pp RbConfig::CONFIG"
script:
- cargo test --no-default-features "$FEATURES"
